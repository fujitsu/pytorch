if(CMAKE_C_COMPILER MATCHES ".*/fcc$" AND
    CMAKE_CXX_COMPILER MATCHES ".*/FCC$")
  if(DEFINED ENV{MPI_HOME})
    set(TCSMPI_EXEC_PATH "$ENV{MPI_HOME}/bin")
  else()
    string(REGEX REPLACE "/FCC$" "" CMAKE_CXX_COMPILER_DIR "${CMAKE_CXX_COMPILER}")
    set(TCSMPI_EXEC_PATH "${CMAKE_CXX_COMPILER_DIR}")
  endif()
  execute_process(COMMAND "${TCSMPI_EXEC_PATH}/mpiFCC" "--show"
    RESULT_VARIABLE MPIFCC_EXEC_RESULT
    OUTPUT_QUIET
    ERROR_QUIET)
  if(MPIFCC_EXEC_RESULT EQUAL 0)
    message(STATUS "TCS-MPI ENABLED")
    set(MPI_CXX_FOUND ON)
    execute_process(COMMAND "${TCSMPI_EXEC_PATH}/mpiFCC" "--showme:compile"
      OUTPUT_VARIABLE MPI_CXX_COMPILE_FLAGS)
    string(REPLACE "\n" "" MPI_CXX_COMPILE_FLAGS "${MPI_CXX_COMPILE_FLAGS}")
    execute_process(COMMAND "${TCSMPI_EXEC_PATH}/mpiFCC" "--showme:incdirs"
      OUTPUT_VARIABLE MPI_CXX_INCLUDE_PATH)
    string(REPLACE "\n" ";" MPI_CXX_INCLUDE_PATH "${MPI_CXX_INCLUDE_PATH}")
    execute_process(COMMAND "${TCSMPI_EXEC_PATH}/mpiFCC" "--showme:link"
      OUTPUT_VARIABLE MPI_CXX_LINK_FLAGS)
    string(REPLACE "\n" "" MPI_CXX_LINK_FLAGS "${MPI_CXX_LINK_FLAGS}")
    execute_process(COMMAND "${TCSMPI_EXEC_PATH}/mpiFCC" "--showme:libdirs"
      OUTPUT_VARIABLE MPI_CXX_LIBRARY_DIRS)
    string(REPLACE "\n" "" MPI_CXX_LIBRARY_DIRS "${MPI_CXX_LIBRARY_DIRS}")
    string(REPLACE " " ";" MPI_CXX_LIBRARY_DIRS "${MPI_CXX_LIBRARY_DIRS}")
    foreach(dir IN LISTS MPI_CXX_LIBRARY_DIRS)
      if(dir MATCHES "FJSVxtclanga" OR dir MATCHES "FJSVstclanga")
        set(MPI_CXX_LIBRARIES "${dir}/libmpi.so")
      endif()
    endforeach()
    set(MPI_FOUND ON)
    set(MPI_C_FOUND ON)
    set(MPIEXEC "${TCSMPI_EXEC_PATH}/mpiexec")
    set(MPI_COMPILE_FLAGS ${MPI_CXX_COMPILE_FLAGS})
    set(MPI_C_COMPILE_FLAGS ${MPI_CXX_COMPILE_FLAGS})
    set(MPI_INCLUDE_PATH ${MPI_CXX_INCLUDE_PATH})
    set(MPI_C_INCLUDE_PATH ${MPI_CXX_INCLUDE_PATH})
    set(MPI_LINK_FLAGS ${MPI_CXX_LINK_FLAGS})
    set(MPI_C_LINK_FLAGS ${MPI_CXX_LINK_FLAGS})
    set(MPI_LIBRARIES ${MPI_CXX_LIBRARIES})
    set(MPI_C_LIBRARIES ${MPI_CXX_LIBRARIES})
  else()
    message(STATUS "TCS-MPI DISABLED")
  endif()
endif()
if(NOT MPI_FOUND)
  set(CMAKE_MODULE_PATH_TMP "${CMAKE_MODULE_PATH}")
  unset(CMAKE_MODULE_PATH)
  find_package(MPI)
  set(CMAKE_MODULE_PATH "${CMAKE_MODULE_PATH_TMP}")
  unset(CMAKE_MODULE_PATH_TMP)
endif()
